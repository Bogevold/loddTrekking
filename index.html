 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loddtrekking v1.0</title>  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>
  .valgt {
    background-image: url(ball.png);
    background-repeat: no-repeat;
    background-position: center center;
    color: green;
    }
  .normal {
    background-color: white;
    color: black;
    }

  .b76 {
    width: 76px;
  }
  ul.vinnere {
    list-style-image: url('ball_liten.png');
  }


  td {
    text-align: center;
    }
    


</style>

<script>
  var ferdig = true;
  var forste = true;
  var varTimer;
  var varTimer2;
  var varLoddene = [];
  var varVinnere = [];
  var varTrukket = 0;
  var antVinnere = 1;
  var vRad = 7;
  var vCol = 5;
  
  var vinnerListe

  function creTable() {
    document.getElementById('Resultat').setAttribute('hidden', '');
    var hentLodd = document.getElementById('antallLodd');
    antLodd = hentLodd.value;
    loddNr = 1;
    var tblCont = document.getElementById('tblCont');
    tblCont.innerHTML = "";
    var tbl = document.createElement('table');
    var tblB = document.createElement('tbody');
    tbl.setAttribute('class', 'table-condensed');
    for (var i = 0; i < vRad; i++) {
        var tr = document.createElement('tr');
        for (var n = 0; n < vCol; n++) {
            var td = document.createElement('td');
            td.appendChild(document.createTextNode(loddNr));
            td.setAttribute('id', "loddNr"+loddNr++);
            tr.appendChild(td);
            
        }
        tblB.appendChild(tr);
    }
    tbl.appendChild(tblB);
    tblCont.appendChild(tbl);
    document.getElementById('inVinnere').setAttribute('max', antLodd);
  }
  
  function nullAlleCeller() {
    var celler = document.getElementsByTagName('td');
    for (var i=0; i < celler.length; i++) {
        celler[i].setAttribute('class', 'normal');
    }
  }

  function nullCeller() {
    for (var i=0; i < varLoddene.length; i++) {
        varLoddene[i].setAttribute('class', 'normal');
        //console.log(celler[i].getAttribute('id'));
    }
  }  
  

  function trekk() {
    document.getElementById('Resultat').setAttribute('hidden', '');
    varLoddene = Array.prototype.slice.call(document.getElementsByTagName('td'));
    starTid = Date.now();
    varVinnere = [];
    varTrukket = 0;
    antVinnere = document.getElementById('inVinnere').value;
    varTimer = window.setInterval(velgLodd, 100);
    while (vinnerListe.firstChild) {
        vinnerListe.removeChild(vinnerListe.firstChild);
    }
  }  

  function velgLodd() {
    nullCeller();
    var nr = Math.floor(Math.random() * varLoddene.length);
    varLoddene[nr].setAttribute('class', 'valgt');
    var varTid = Date.now() - starTid;
    var varIntervall = document.getElementById('inTid').value * 1000/antVinnere;
    console.log("Tid: " + varTid);
    console.log("Intervall: " + varIntervall);
    console.log("varTrukket: " + varTrukket);
    if (varTid  > varIntervall*(1+varTrukket) ) {
      varTrukket++;
      varVinnere.push(varLoddene[nr]);
      varLoddene.splice(nr,1);
      if (antVinnere==varTrukket) {
        window.clearInterval(varTimer);
      }
            
      var vinnerLoddInn = varVinnere[varVinnere.length - 1].childNodes[0].nodeValue;
      console.log("Node value: " + vinnerLoddInn);

      var punkt = document.createElement('li');
      punkt.setAttribute('class', 'vinnere');
      punkt.appendChild(document.createTextNode("Vinner nr " + (varVinnere.length) + " ble lodd nr: " + vinnerLoddInn));

      if (varTrukket == 1) {
        var res = document.getElementById('Resultat');
        res.removeAttribute('hidden');
        var vinnereTxt = document.createElement('div');
        vinnerListe = document.createElement('ul');

        vinnereTxt.appendChild(vinnerListe);
        res.appendChild(vinnereTxt);
      }

      vinnerListe.appendChild(punkt);

  
    }
    
  }
  
  
  
  function velgInn() {
    document.getElementById("tabInn").setAttribute('class', 'active');
    document.getElementById("tabTrekk").removeAttribute('class');
    document.getElementById("divInnstillinger").removeAttribute('hidden');
    document.getElementById("divTrekking").setAttribute('hidden', '');
  }

  function velgTrekk() {
    document.getElementById("tabTrekk").setAttribute('class', 'active');
    document.getElementById("tabInn").removeAttribute('class');
    document.getElementById("divTrekking").removeAttribute('hidden');
    document.getElementById("divInnstillinger").setAttribute('hidden', '');
  }
  
  function fBeregn() {
    vRad = document.getElementById('antallRader').value;
    vCol = document.getElementById('antallKol').value;
    var antLoddB = vRad * vCol;
    document.getElementById('antallLodd').value = antLoddB;
  }
  
  var starTid;
</script>
</head>

<body onLoad="creTable()">  
  <ul class= "nav nav-tabs">
    <li role="presentation" class="active" id="tabTrekk"><a href="#" onClick="velgTrekk()">Trekking</a></li>
    <li role="presentation" id="tabInn"><a href="#" onClick="velgInn()">Innstillinger</a></li>
  </ul>

  <div id="divInnstillinger" style="width: 500px;" hidden>

     <div class="input-group">    
      <input type="number" class="form-control" id="antallRader" min="1" max="5000" step="1" value="7" aria-describedby="addonRad" onChange="fBeregn()">
      <span class="input-group-addon" id="addonRad">Antall rader</span>
    </div> 
    <div class="input-group">    
      <input type="number" class="form-control" id="antallKol" min="1" max="500" step="1" value="5" aria-describedby="addonKol"  onChange="fBeregn()">
      <span class="input-group-addon" id="addonKol">Antall kolonner</span>
    </div>  
  
  <div class="input-group">    
      <input type="number" class="form-control" id="antallLodd" readonly value="35" aria-describedby="basic-addon1">
      <span class="input-group-addon" id="basic-addon1">Antall lodd</span>
    </div>
    
    <div class="input-group">    
      <input type="number" class="form-control" id="inTid" min="1" max="360" step="1" value="10" aria-describedby="basic-addon2">
      <span class="input-group-addon" id="basic-addon2">Sekunder trekking foreg√•r</span>
    </div>
    
    <div class="input-group">        
      <input type="number" class="form-control" id="inVinnere" min="1" step="1" value="1" aria-describedby="basic-addon3">
      <span class="input-group-addon" id="basic-addon3">Ant vinnere</span>
    </div>
    <p style="padding:10px;">
    <button class='btn' onClick="creTable()">Opprett tabell</button>
    </p>
  </div>
  
  <div id="divTrekking" style="margin:auto; padding:50px;">
    <button class='btn b76'  onClick="trekk()">Trekk</button>
    <p/>
    <div id="tblCont" ></div>
    <div id="Resultat" hidden ><h1>Vinnerne er trukket</h1></div>
  </div>
</body>

</html> 